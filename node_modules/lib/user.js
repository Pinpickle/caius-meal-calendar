'use strict';

var mongoose = require('mongoose');
var sh = require('shorthash');
var slug = require('slug');

var userSchema = mongoose.Schema({
  _camId: String,
  cookies: [ { } ],
  slug: String
});

userSchema.virtual('camId').get(function () {
  return this._camId;
}).set(function (val) {
  this._camId = val;
  this.slug = User.generateSlug(val);
});

userSchema.methods.getEmail = function getEmail() {
  return this.camId + '@cam.ac.uk';
};

userSchema.statics.generateSlug = function generateSlug(id) {
  return slug(id) + '-' + sh.unique(id);
};

var User = module.exports = mongoose.model('User', userSchema);
